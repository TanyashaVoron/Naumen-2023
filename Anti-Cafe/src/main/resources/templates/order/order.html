<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Заказ</title>
</head>
<body>
<a th:href="@{/search}">Назад</a>
<form th:if="${!sendDTO.isTaggedDelete()&&sendDTO.isAccess()}" th:method="POST" th:action="@{/order/markForDeletion}">
    <input type="hidden" th:value="${sendDTO.getOrderId()}" th:name="orderId">
    <input type="submit" value="Пометить на удаление"/>
</form>
<input type="hidden" name="_csrf" th:value="${_csrf.token}"/>
<table th:if="${sendDTO.getGameZone().isEmpty()}">
    <tr>
        <th>Официант</th>
        <th>Резерв столов</th>
    </tr>
    <tr>
        <td>
            <a th:text="${sendDTO.getEmployeeOrder()}"/>
        </td>
        <td>
            <a th:if="${sendDTO.isAccess()}" th:href="@{/order/{id}/reserve(id=${sendDTO.getOrderId()})}" th:text="'Добавить резерв'"></a>
        </td>
    </tr>
</table>
<table th:if="${sendDTO.getGameZone().isPresent()}">
    <tr>
        <th>Официант</th>
        <th>Игровая зона</th>
        <th>Дата резерва</th>
        <th>Время резерва</th>
        <th>Резерв до</th>
        <th>Действия</th>
    </tr>
    <tr>
        <td>
            <a th:text="${sendDTO.getEmployeeOrder()}"/>
        </td>
        <td>
            <a th:text="${sendDTO.getGameZoneId()}+':'+${sendDTO.getGameZone().get()}"/>
        </td>
        <td>
            <a th:text="${sendDTO.getReserveDate()}"/>
        </td>
        <td>
             <a  th:text="${sendDTO.getReserveTime()}"/>
        </td>
        <td>
            <a th:text="${sendDTO.getEndReserve()}"/>
        </td>
        <td>
            <a th:if="${sendDTO.isAccess()}" th:href="@{/order/{id}/reserve(id=${sendDTO.getOrderId()})}" th:text="'Изменить резерв'"></a>
            <form th:if="${sendDTO.isAccess()}" th:method="POST" th:action="@{/order/deleteReserve}">
                <input type="hidden" th:value="${sendDTO.getOrderId()}" th:name="orderId">
                <input type="submit" th:value="'Отменить резерв'">
            </form>
        </td>
    </tr>
</table>
<hr>
<table>
    <tr>
        <th>Гости</th>
        <th>Товары</th>
    </tr>
    <tr>
        <td>
            <table>
                <tr>
                    <th>Гость</th>
                    <th>Действие</th>
                </tr>
                <tr th:each="guest:${sendDTO.getGuestList()}">
                    <td>
                        <a th:href="@{/guest/{id}?order={order_id}(order_id=${sendDTO.getOrderId()},id=${guest.getId()})}" th:text="${guest.getName()}"></a>
                    </td>
                    <td>
                        <a th:if="${sendDTO.getGuestMessageError().isPresent()&&sendDTO.getGuestIdError().get().equals(guest.getId())}" th:text="${sendDTO.getGuestMessageError().get()}"></a>
                        <form th:if="${sendDTO.isAccess()}" th:method="POST" th:action="@{/order/deleteGuest}">
                            <input type="hidden" th:value="${guest.getId()}" th:name="guestId">
                            <input type="hidden" th:value="${sendDTO.getOrderId()}" th:name="orderId">
                            <input type="submit" th:value="'Удалить клиента'">
                        </form>
                    </td>
                </tr>
                <tr>
                    <td>
                        <form th:if="${sendDTO.isAccess()}" th:method="POST" th:action="@{/order/addGuest}">
                            <input type="hidden" th:value="${sendDTO.getOrderId()}" th:name="orderId">
                            <input type="submit" value="Добавить гостя"/>
                        </form>
                    </td>
                </tr>
            </table>
        </td>
        <td>
            <table>
                <tr>
                    <th>№</th>
                    <th>Позиция</th>
                    <th>Количество</th>
                    <th>Гость</th>
                </tr>
                <tr th:each="product:${sendDTO.getGuestCartList()}">
                    <td>
                        <a th:text="${product.getId()}"></a>
                    </td>
                    <td>
                        <a th:text="${product.getProductName()}"></a>
                    </td>
                    <td>
                        <a th:text="${product.getQuantity()}"></a>
                    </td>
                    <td>
                        <a th:text="${product.getGuestName()}"></a>
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>
<hr>
<form th:if="${!sendDTO.isPayment()}" th:method="POST" th:action="@{/order/payment}">
    <input type="hidden" th:value="${sendDTO.getOrderId()}" th:name="orderId">
    <input type="submit" value="Оплатить"/>
</form>
<a th:if="${sendDTO.isPayment()}" th:text="Оплачено"></a>
<a th:text="'Итог: '+${sendDTO.total}">user</a>
<a th:text="${sendDTO.getEmployee()}"></a>
<br/>
</body>
</html>