<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Заказ</title>
</head>
<body>
<a th:href="@{/search}">Назад</a>
<form th:if="${!order.getTaggedDelete()}" th:method="POST" th:action="@{/order/markForDeletion}">
    <input type="hidden" th:value="${order.getId()}" th:name="orderId">
    <input type="submit" value="Пометить на удаление"/>
</form>
<input type="hidden" name="_csrf" th:value="${_csrf.token}"/>
<table th:if="${order.getGameZone()==null}">
    <tr>
        <th>Официант</th>
        <th>Резерв столов</th>
    </tr>
    <tr>
        <td>
            <a th:if="${order.getManager()!=null}" th:text="${order.getManager().getName()}"/>
        </td>
        <td>
            <a th:href="@{/order/{id}/reserve(id=${order.getId()})}" th:text="'Добавить резерв'"></a>
        </td>
    </tr>
</table>
<table th:if="${order.getGameZone()!=null}">
    <tr>
        <th>Официант</th>
        <th>Игровая зона</th>
        <th>Дата резерва</th>
        <th>Время резерва</th>
        <th>Резерв до</th>
        <th>Действия</th>
    </tr>
    <tr>
        <td>
            <a th:if="${order.getManager()!=null}" th:text="${order.getManager().getName()}"/>
        </td>
        <td>
            <a th:if="${order.getGameZone()!=null}"
               th:text="${order.getGameZone().getId()}+':'+${order.getGameZone().getName()}"/>
        </td>
        <td>
            <a th:if="${order.getReserveDate()!=null}"
               th:text="${order.getReserveDate().getDayOfMonth()}+'.'+${order.getReserveDate().getMonthValue()} + '.'+ ${order.getReserveDate().getYear()}"/>
        </td>
        <td>
            <a th:if="${order.getReserveTime()!=null}"
               th:text="${order.getReserveTime().getHour()}+':'+${order.getReserveTime().getMinute()}+'0'"/>
        </td>
        <td>
            <a th:if="${order.getEndReserve()!=null}"
               th:text="${order.getEndReserve().getHour()}+':'+${order.getEndReserve().getMinute()}"/>
        </td>
        <td>
            <a th:href="@{/order/{id}/reserve(id=${order.getId()})}" th:text="'Изменить резерв'"></a>
            <form th:method="POST" th:action="@{/order/deleteReserve}">
                <input type="hidden" th:value="${order.getId()}" th:name="orderId">
                <input type="submit" th:value="'Отменить резерв'">
            </form>
        </td>
    </tr>
</table>
<hr>
<table>
    <tr>
        <th>Гости</th>
        <th>Товары</th>
    </tr>
    <tr>
        <td>
            <table>
                <tr>
                    <th>Гость</th>
                    <th>Действие</th>
                </tr>
                <tr th:each=" guest:${guests}">
                    <td>
                        <a th:href="@{/guest/{id}?order={order_id}(order_id=${order.getId()},id=${guest.getCompositeId().getGuestId()})}" th:text="${guest.getName()}"></a>
                    </td>
                    <td>
                        <a th:if="${errorGuestMessage.isPresent()&&errorGuestId.isPresent()&&errorGuestId.get().equals(guest.getCompositeId().getGuestId())}" th:text="${errorGuestMessage.get()}"></a>
                        <form th:method="POST" th:action="@{/order/deleteGuest}">
                            <input type="hidden" th:value="${guest.getCompositeId().getGuestId()}" th:name="guestId">
                            <input type="hidden" th:value="${order.getId()}" th:name="orderId">
                            <input type="submit" th:value="'Удалить клиента'">
                        </form>
                    </td>
                </tr>
                <tr>
                    <td>
                        <form th:method="POST" th:action="@{/order/addGuest}">
                            <input type="hidden" th:value="${order.getId()}" th:name="orderId">
                            <input type="submit" value="Добавить гостя"/>
                        </form>
                    </td>
                </tr>
            </table>
        </td>
        <td>
            <table>
                <tr>
                    <th>№</th>
                    <th>Позиция</th>
                    <th>Количество</th>
                    <th>Гость</th>
                </tr>
                <tr th:each="product:${products}">
                    <td>
                        <a th:text="${product.getId()}"></a>
                    </td>
                    <td>
                        <a th:text="${product.getProduct().getName()}"></a>
                    </td>
                    <td>
                        <a th:text="${product.getQuantity()}"></a>
                    </td>
                    <td>
                        <a th:text="${product.getGuest().getName()}"></a>
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>
<hr>
<form th:if="${!order.getPayment()}" th:method="POST" th:action="@{/order/payment}">
    <input type="hidden" th:value="${order.getId()}" th:name="orderId">
    <input type="submit" value="Оплатить"/>
</form>
<a th:if="${order.getPayment()}" th:text="Оплачено"></a>
<a th:text="'Итог: '+${total}">user</a>
<a th:if="${user.isPresent()}" th:text="${user.get().getName()}"></a>
<br/>
</body>
</html>